# PyPI Trusted Publisher Configuration

This document provides instructions for configuring Trusted Publishers for PyPI and TestPyPI.

## What is Trusted Publishing?

Trusted Publishing allows GitHub Actions workflows to publish packages to PyPI without using API tokens or passwords. Instead, it uses OpenID Connect (OIDC) tokens that are automatically generated by GitHub.

## Configuration Steps

### For TestPyPI

1. Go to [https://test.pypi.org/manage/account/publishing/](https://test.pypi.org/manage/account/publishing/)
2. Click "Add a new publisher"
3. Enter the following details:
   - **PyPI Project Name**: `purpleair-data-logger` (or your package name from setup.py/setup.cfg)
   - **Owner**: `carlkidcrypto`
   - **Repository name**: `purpleair_data_logger` (NOT `ezsnmp`)
   - **Workflow name**: `build_and_publish_to_test_pypi.yml`
   - **Environment name**: `build_and_publish_to_test_pypi`

### For Production PyPI

1. Go to [https://pypi.org/manage/account/publishing/](https://pypi.org/manage/account/publishing/)
2. Click "Add a new publisher"
3. Enter the following details:
   - **PyPI Project Name**: `purpleair-data-logger` (or your package name from setup.py/setup.cfg)
   - **Owner**: `carlkidcrypto`
   - **Repository name**: `purpleair_data_logger`
   - **Workflow name**: `build_and_publish_to_pypi.yml`
   - **Environment name**: `build_and_publish_to_pypi`

## Important Notes

- The repository name **must** match exactly: `purpleair_data_logger` (not `ezsnmp`)
- The workflow name **must** match the filename in `.github/workflows/`
- For TestPyPI, the environment name **must** be `build_and_publish_to_test_pypi`
- The package must already exist on TestPyPI/PyPI, or you need to create it first with a manual upload

## Troubleshooting

If you see an error like:
```
invalid-publisher: valid token, but no corresponding publisher (Publisher with matching claims was not found)
```

This means the configuration in PyPI/TestPyPI doesn't match the workflow. Common issues:
- Wrong repository name (e.g., `ezsnmp` instead of `purpleair_data_logger`)
- Wrong workflow filename
- Missing or incorrect environment name
- Wrong owner name

## References

- [PyPI Trusted Publishers Documentation](https://docs.pypi.org/trusted-publishers/)
- [PyPI Trusted Publishers Troubleshooting](https://docs.pypi.org/trusted-publishers/troubleshooting/)
- [GitHub Actions PyPI Publish Action](https://github.com/marketplace/actions/pypi-publish)
